# Drupal Security Hardening Rules (Universal)
# Include this file in your site-specific Drupal nginx config
# Note: Rate limits and IP allowlists should be configured per-site

# Block hidden files and directories
location ~ /\. {
    deny all;
}

# Block version control directories
location ~ /\.(git|svn|hg|bzr|cvs) {
    deny all;
}

# Block backup and patch directories
location ~ ^/(backup|patches)/ {
    deny all;
}

# Block vendor directory PHP execution
location ~ ^/vendor/.*\.php$ {
    deny all;
}

# Block PHP execution in sites files directories
location ~ ^/sites/[^/]+/files/.*\.php$ {
    deny all;
}

# Block sensitive Drupal files
location ~* \.(engine|inc|install|make|module|profile|po|pot|sh|theme|twig|tpl\.php|xtmpl|yml|yaml)$ {
    deny all;
}

# Block composer files
location ~* (composer\.(json|lock)|package\.json|yarn\.lock)$ {
    deny all;
}

# Block text files that could leak info
location ~* (README|CHANGELOG|LICENSE|INSTALL|UPGRADE).*\.txt$ {
    deny all;
}

# Block web.config
location = /web.config {
    deny all;
}

# Optimize favicon and robots
location = /favicon.ico {
    access_log off;
    log_not_found off;
}

location = /robots.txt {
    access_log off;
    log_not_found off;
    allow all;
}
