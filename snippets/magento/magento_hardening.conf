# Magento 2 Security Hardening Rules (Universal)
# Include this file in your site-specific Magento 2 nginx config
# Note: Rate limits and IP allowlists should be configured per-site
# Important: Root should be set to pub/ directory

# Block hidden files and directories
location ~ /\. {
    deny all;
}

# Block internal Magento directories
location ~ ^/(app|generated|lib|bin|var|tmp|phpserver|vendor)/ {
    deny all;
}

# Block setup and update directories
location ~ ^/(setup|update)/ {
    deny all;
}

# Block sensitive media directories
location ~ ^/pub/media/(customer|downloadable|import|custom_options)/ {
    deny all;
}

# Block theme customization XML files
location ~ ^/pub/media/theme_customization/.*\.xml$ {
    deny all;
}

# Block .user.ini files
location ~ \.user\.ini$ {
    deny all;
}

# Block .htaccess and .htpasswd
location ~ /\.(htaccess|htpasswd)$ {
    deny all;
}

# Block unauthorized PHP/PHTML files
location ~ ^/pub/.*\.(php|phtml)$ {
    deny all;
}

# Optimize favicon and robots
location = /favicon.ico {
    access_log off;
    log_not_found off;
}

location = /robots.txt {
    access_log off;
    log_not_found off;
    allow all;
}
